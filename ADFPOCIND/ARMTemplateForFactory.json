{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "ADFPOCIND"
		},
		"SqlServer1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'SqlServer1'"
		},
		"KeyVaultLinkedService_properties_typeProperties_baseUrl": {
			"type": "string",
			"defaultValue": "https://IndegeneViforPOC.vault.azure.net/"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_AFD_Trigger')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_AFD",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_AFD_Keyvault",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:00Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_AFD_Keyvault')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_Cancelled_Withdrawn_Trigger')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_Cancelled",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_Cancelled_Withdrawn_Keyvault",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:06:25Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_Cancelled_Withdrawn_Keyvault')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_Draft_Trigger')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_Draft",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_Draft_Keyvault",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_Draft_Keyvault')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_Expiry_Trigger')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_Expiry",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_Expiry_Keyvault",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_Expiry_Keyvault')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_Expiry_Trigger1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_Expiry",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_Expiry_Keyvault1",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_Expiry_Keyvault1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/001_PL_MC_Reapproval_Trigger')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SP_add_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_batch_log]",
							"storedProcedureParameters": {
								"adf_instance": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_messages": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": null,
									"type": "DateTime"
								},
								"job_start_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"pipeline_name": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"processed_asset_count": {
									"value": null,
									"type": "Int32"
								},
								"project_name": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_platform_name": {
									"value": "Veeva Vault Promo Mats",
									"type": "String"
								},
								"source_username": {
									"value": "avirup.das@sb-viforpharma",
									"type": "String"
								},
								"target_platform_name": {
									"value": "Vifor VINCI MC",
									"type": "String"
								},
								"target_username": {
									"value": "avirup.das.external@viforpharma.com",
									"type": "String"
								},
								"total_asset_count": {
									"value": null,
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_002_Keyvault_MC_Reapproval",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "SP_add_batch_log",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "002_PL_MC_Reapproval_Keyvault",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"Execution_ID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/4. Reapproval"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:00Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/002_PL_MC_Reapproval_Keyvault')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_AFD_Keyvault')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_002_VINCI_MC_Master_AFD",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_AFD_Success_Email_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_AFD_Master",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"AFD_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_AFD_Success_Email_TemplateID').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_AFD_Success_Email_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-AFD-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_AFD_Master')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_Cancelled_Withdrawn_Keyvault')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_003_VINCI_MC_Master_Cancelled",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Archival_FolderID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Cancelled_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Withdrawn_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_NotReApproved_Success_TemplateID_copy1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_Cancelled_Withdrawn_Master",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"VINCI_MC_Archival_Folder_ID": {
									"value": "@activity('WEB_Keyvault_Archival_FolderID').output.value",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"Cancelled_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Cancelled_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								},
								"Withdrawn_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Withdrawn_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"NotReApproved_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_NotReApproved_Success_TemplateID_copy1').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Archival_FolderID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-Archival-Folder-ID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_Cancelled_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Cancelled-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Withdrawn_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Withdrawn-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_NotReApproved_Success_TemplateID_copy1",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-NotApprovedforContinuedUse-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:06:23Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_Cancelled_Withdrawn_Master')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_Draft_Keyvault')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_003_Get_VVPM_Doc_Details_Draft",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Draft_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Draft_Error_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_ReDraft_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_Draft_Get_VVPM_Doc_Details",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"Draft_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Draft_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"Draft_Error_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Draft_Error_TemplateID').output.value",
									"type": "Expression"
								},
								"ReDraft_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_ReDraft_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_Draft_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Draft-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Draft_Error_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Draft-Error-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_ReDraft_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Redraft-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:01Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_Draft_Get_VVPM_Doc_Details')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_Expiry_Keyvault')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_002_VINCI_MC_Master_Expiry",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Archival_FolderID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Expiry_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_Expiry_Master",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"VINCI_MC_Archival_Folder_ID": {
									"value": "@activity('WEB_Keyvault_Archival_FolderID').output.value",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"Expiry_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Expiry_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Archival_FolderID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-Archival-Folder-ID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_Expiry_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Expiry-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_Expiry_Master')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_Expiry_Keyvault1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_002_VINCI_MC_Master_Expiry",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Archival_FolderID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Expiry_Success_TemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_Expiry_Master1",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"VINCI_MC_Archival_Folder_ID": {
									"value": "@activity('WEB_Keyvault_Archival_FolderID').output.value",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"Expiry_Success_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Expiry_Success_TemplateID').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Archival_FolderID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-Archival-Folder-ID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_Expiry_Success_TemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-Expiry-Success-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:02Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_Expiry_Master1')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/002_PL_MC_Reapproval_Keyvault')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Keyvault_Get_VVPM_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMBaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Username",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMUsername?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VVPM_Password",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VVPMPassword?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_VVPM_Auth",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Get_VVPM_Password",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Username",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VVPM_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value,'/api/v21.2/auth')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": {
								"value": "@concat('username=',activity('WEB_Keyvault_Get_VVPM_Username').output.value,'&password=',activity('WEB_Keyvault_Get_VVPM_Password').output.value)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Keyvault_Emailnotification_url",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/AF-SendEmailNotification?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "PL_002_VINCI_MC_Master_Draft",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_Keyvault_Emailnotification_url",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_DF_EmailId",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Reapproval_EmailTemplateID",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "003_PL_MC_Reapproval_Master",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"VVPM_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VVPM_Baseurl').output.value",
									"type": "Expression"
								},
								"VVPM_SessionId": {
									"value": "@activity('WEB_VVPM_Auth').output.sessionId",
									"type": "Expression"
								},
								"VINCI_MC_BaseUrl": {
									"value": "@activity('WEB_Keyvault_Get_VINCI_MC_Baseurl').output.value",
									"type": "Expression"
								},
								"Execution_ID": {
									"value": "@pipeline().parameters.Execution_ID",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@activity('WEB_Keyvault_Emailnotification_url').output.value",
									"type": "Expression"
								},
								"Reapproval_EmailTemplate_ID": {
									"value": "@activity('WEB_Keyvault_Reapproval_EmailTemplateID').output.value",
									"type": "Expression"
								},
								"DF_EmailID": {
									"value": "@activity('WEB_Keyvault_DF_EmailId').output.value",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "WEB_Keyvault_Get_VINCI_MC_Baseurl",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-BaseUrl?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "WEB_Keyvault_DF_EmailId",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/MC-DigitalFactory-EmailID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					},
					{
						"name": "SP_add_asset_log_vvpm_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Auth",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "VVPM Authentication Error",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_VVPM_Auth').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Draft - Blank Email Template - Failure",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "WEB_Keyvault_Reapproval_EmailTemplateID",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/SendGrid-MC-InReapprovalSuccess-TemplateID?api-version=7.0')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {},
							"linkedServices": [
								{
									"referenceName": "KeyVaultLinkedService",
									"type": "LinkedServiceReference"
								}
							],
							"authentication": {
								"type": "MSI",
								"resource": "https://vault.azure.net"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/4. Reapproval"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/003_PL_MC_Reapproval_Master')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_AFD_Master')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_AFD_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,version_modified_date__v FROM documents WHERE  status__v = ''Approved for Distribution'' and published_from_uat_to_prod__c = ''false'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_AFDdoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_AFDdoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_AFD_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v, email_template_type__c,created_by__v,make_available_in_dams__c,language__c,therapeutic_area__c,expiration_date__c,country__v,product__v FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Country_Loop_MC_AFD",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_AFD_Country",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"AFD_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.AFD_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:30:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "FE_AFDdoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_AFD_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_AFD_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "published_from_uat_to_prod__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_MC_update_batch_log_AFD",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_AFDdoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_AFD_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_AFD_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"AFD_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"ML_Expiration_date": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:47:19Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_AFD_Country')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_Cancelled_Withdrawn_Master')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_Cancelled_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,version_modified_date__v FROM documents WHERE  status__v CONTAINS (''Cancelled'',''Withdrawn'',''Not Approved for Continued Use'') and deactivated__c = ''false'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_Cancelleddoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_Cancelleddoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Cancelled_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v, email_template_type__c,created_by__v,make_available_in_dams__c,country__v,product__v,status__v FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:30:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "004_PL_Country_Loop_MC_Expiry",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_Cancelled_Withdrawn_Country",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Archival_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Cancelled_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											},
											"Withdrawn_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"NotReApproved_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "FE_Cancelleddoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Cancelled_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Cancelled_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "deactivated__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_MC_update_batch_log_Cancelled",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_Cancelleddoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_Cancelled_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_Cancelled_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:48:32Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_Cancelled_Withdrawn_Country')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_Draft_Get_VVPM_Doc_Details')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_Draft_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,document_creation_date__v,version_modified_date__v FROM documents WHERE status__v = ''Draft'' and placeholder_created__c = ''false'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_Draftdoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_Draftdoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Draft_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,product__v,country__v,created_by__v,email_template_type__c,title__v FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "004_PL_Loop_Country",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Email_Asset_Type",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_Draft_Country",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Draft_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Draft_Error_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Error_EmailTemplate_ID",
												"type": "Expression"
											},
											"ReDraft_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											},
											"Email_Asset_Type": {
												"value": "@activity('LK_Email_Asset_Type').output",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:30:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Email_Asset_Type",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_asset_type_id]",
											"storedProcedureParameters": {
												"asset_type_id": {
													"type": "Int32",
													"value": null
												},
												"asset_type_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_VVPM_Doc_Details').output.data[0].email_template_type__c[0]",
														"type": "Expression"
													}
												},
												"html": {
													"type": "String",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": true
									}
								}
							]
						}
					},
					{
						"name": "FE_Draftdoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Draft_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Draft_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "placeholder_created__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_update_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_Draftdoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_Draft_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_Draft_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Draft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Draft_Error_EmailTemplate_ID": {
						"type": "string"
					},
					"ReDraft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"Digital_Factory_BU": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:44:45Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_Draft_Country')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable11')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_Expiry_Master')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_Expiry_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,version_modified_date__v FROM documents WHERE  status__v = ''Expired'' and deactivated__c = ''false'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_Expireddoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_Expirydoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Expiry_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v, email_template_type__c,created_by__v,make_available_in_dams__c,country__v,product__v FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:30:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "004_PL_Country_Loop_MC_Expiry",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_Expiry_Country",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Archival_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "FE_Expirydoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Expiry_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Expiry_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "deactivated__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_MC_update_batch_log_Expired",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_Expireddoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_Expiry_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_Expiry_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:47:40Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_Expiry_Country')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_Expiry_Master1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_Expiry_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,version_modified_date__v FROM documents WHERE  status__v = ''Expired'' and deactivated__c = ''false'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_Expireddoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_Expirydoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Expiry_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v, email_template_type__c,created_by__v,make_available_in_dams__c,country__v,product__v FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:30:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "004_PL_Country_Loop_MC_Expiry",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_Expiry_Country1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Archival_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "FE_Expirydoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Expiry_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Expiry_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "deactivated__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_MC_update_batch_log_Expired",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_Expireddoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_Expiry_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_Expiry_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:47:40Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_Expiry_Country1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/003_PL_MC_Reapproval_Master')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_VVPM_Reapproval_Doc",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,version_modified_date__v FROM documents WHERE  status__v = ''In Reapproval'' and placeholder_created__c = ''true'' and type__v = ''Cross-Functional Material'' and subtype__v = ''Email'' and classification__v = ''VINCI MC Email'' ORDER BY version_modified_date__v ASC')",
								"type": "Expression"
							},
							"method": "GET",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "FE_Reapprovaldoc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "FE_Reapprovaldoc_Lock",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Reapproval_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_VVPM_Doc_Details",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT id,name__v,document_number__v,product__v,country__v,created_by__v,email_template_type__c FROM documents WHERE  document_number__v = ''',item().document_number__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_005_Country_Loop_Dev",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_PO_EmailID_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "004_PL_MC_Reapproval_Country",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Reapproval_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Reapproval_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@activity('WEB_VVPM_Doc_Details').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@activity('WEB_Get_PO_EmailID_VVPM').output.data[0].user_email__v",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_PO_EmailID_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_VVPM_Doc_Details",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT user_email__v FROM users WHERE id = ''',activity('WEB_VVPM_Doc_Details').output.data[0].created_by__v,'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "FE_Reapprovaldoc_Lock",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "WEB_VVPM_Reapproval_Doc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('WEB_VVPM_Reapproval_Doc').output.data",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_lock_document_VVPM",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',item().id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "placeholder_created__c=null"
									}
								}
							]
						}
					},
					{
						"name": "SP_update_batch_log",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "FE_Reapprovaldoc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[update_batch_log]",
							"storedProcedureParameters": {
								"errors_message": {
									"value": null,
									"type": "String"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"failed_asset_count": {
									"value": {
										"value": "@sub(activity('WEB_VVPM_Reapproval_Doc').output.responseDetails.total,int(variables('processed')))",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"job_duration": {
									"value": null,
									"type": "TimeSpan"
								},
								"job_end_time": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"processed_asset_count": {
									"value": {
										"value": "@variables('processed')",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"total_asset_count": {
									"value": {
										"value": "@activity('WEB_VVPM_Reapproval_Doc').output.responseDetails.total",
										"type": "Expression"
									},
									"type": "Int32"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Reapproval_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/4. Reapproval"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-29T09:48:08Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/004_PL_MC_Reapproval_Country')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_AFD_Country')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable1",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_005_Product_loop_MC_AFD",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_AFD_Product",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"AFD_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.AFD_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"VVPM_Country_Details": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@activity('LK_BU_Name_SP').output",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"AFD_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"ML_Expiration_date": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable1')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_AFD_Product')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_Cancelled_Withdrawn_Country')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "LK_Archival_Folder_ID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from vfr.vinci_mc_folder_master where folder_name = ''Archival_Expired_Emails'' and folder_type = ''Archival ',activity('LK_BU_Name_SP').output.firstRow.bu_name,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "PL_005_Product_Loop_MC_Cancelled",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Archival_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_Cancelled_Withdrawn_Product",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Cancelled_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Archival_Folder_ID": {
												"value": "@activity('LK_Archival_Folder_ID').output.firstRow.folder_id",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@activity('LK_BU_Name_SP').output",
												"type": "Expression"
											},
											"VVPM_Country_Details": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output",
												"type": "Expression"
											},
											"Withdrawn_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"NotReApproved_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:02:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable14')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_Cancelled_Withdrawn_Product')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_Draft_Country')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_005_Loop_Product",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_IQ_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_Draft_Product",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Draft_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Draft_Error_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Error_EmailTemplate_ID",
												"type": "Expression"
											},
											"ReDraft_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@activity('LK_BU_Name_SP').output",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
												"type": "Expression"
											},
											"VINCI_MC_IQ_Folder_ID": {
												"value": "@activity('LK_IQ_Folder_ID').output.firstRow.folder_id",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Email_Asset_Type": {
												"value": "@pipeline().parameters.Email_Asset_Type",
												"type": "Expression"
											},
											"VVPM_Country_Abbrevation": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].abbreviation__c",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_IQ_Folder_ID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from vfr.vinci_mc_folder_master where folder_name = ''_IQ'' and folder_type = ''Root ',activity('LK_BU_Name_SP').output.firstRow.bu_name,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Draft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Draft_Error_EmailTemplate_ID": {
						"type": "string"
					},
					"ReDraft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Email_Asset_Type": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"Digital_Factory_BU": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable11')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_Draft_Product')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_Expiry_Country')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "LK_Archival_Folder_ID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from vfr.vinci_mc_folder_master where folder_name = ''Archival_Expired_Emails'' and folder_type = ''Archival ',activity('LK_BU_Name_SP').output.firstRow.bu_name,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "PL_005_Product_Loop_MC_Expiry",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Archival_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_Expiry_Product",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Archival_Folder_ID": {
												"value": "@activity('LK_Archival_Folder_ID').output.firstRow.folder_id",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@activity('LK_BU_Name_SP').output",
												"type": "Expression"
											},
											"VVPM_Country_Details": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:00Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable12')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_Expiry_Product')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_Expiry_Country1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "LK_Archival_Folder_ID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from vfr.vinci_mc_folder_master where folder_name = ''Archival_Expired_Emails'' and folder_type = ''Archival ',activity('LK_BU_Name_SP').output.firstRow.bu_name,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "PL_005_Product_Loop_MC_Expiry",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Archival_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_Expiry_Product1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Archival_Folder_ID": {
												"value": "@activity('LK_Archival_Folder_ID').output.firstRow.folder_id",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@activity('LK_BU_Name_SP').output",
												"type": "Expression"
											},
											"VVPM_Country_Details": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:57:00Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable121')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_Expiry_Product1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/004_PL_MC_Reapproval_Country')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Country",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].country__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Get_VVPM_Country_Name_BU",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM country__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_BU_Name_SP",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Country_Name_BU",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_bu_name]",
											"storedProcedureParameters": {
												"bu_name": {
													"type": "String",
													"value": null
												},
												"country_name": {
													"type": "String",
													"value": {
														"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output.data[0].name__v",
														"type": "Expression"
													}
												},
												"has_multiple_country": {
													"type": "Boolean",
													"value": null
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable13",
											"type": "DatasetReference",
											"parameters": {}
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientID-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_BU_Name_SP",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat('https://',replace(pipeline().DataFactory,'ADF','AKV'),'.vault.azure.net/secrets/VINCI-MC-ClientSecret-',activity('LK_BU_Name_SP').output.firstRow.bu_name,'?api-version=7.0')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"linkedServices": [
											{
												"referenceName": "KeyVaultLinkedService",
												"type": "LinkedServiceReference"
											}
										],
										"authentication": {
											"type": "MSI",
											"resource": "https://vault.azure.net"
										}
									}
								},
								{
									"name": "WEB_VINCI_BU_MC_Auth",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret",
											"dependencyConditions": [
												"Succeeded"
											]
										},
										{
											"activity": "WEB_Keyvault_Get_VINCI_MC_BU_ClientID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.auth.marketingcloudapis.com/v2/token')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": {
											"value": "@concat('grant_type=client_credentials&client_id=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientID').output.value,'&client_secret=',activity('WEB_Keyvault_Get_VINCI_MC_BU_ClientSecret').output.value)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_005_Product_Loop_Reapproval",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_VINCI_BU_MC_Auth",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "005_PL_MC_Reapproval_Product",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"Reapproval_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Reapproval_EmailTemplate_ID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@activity('WEB_VINCI_BU_MC_Auth').output.access_token",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@activity('WEB_Get_VVPM_Country_Name_BU').output",
												"type": "Expression"
											},
											"BU_Name": {
												"value": "@activity('LK_BU_Name_SP').output.firstRow.bu_name",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Reapproval_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/4. Reapproval"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable13')]",
				"[concat(variables('factoryId'), '/linkedServices/KeyVaultLinkedService')]",
				"[concat(variables('factoryId'), '/pipelines/005_PL_MC_Reapproval_Product')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_AFD_Product')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "If MC_Available",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@greater(activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count,0)",
											"type": "Expression"
										},
										"ifTrueActivities": [
											{
												"name": "WEB_update_tag_Approved",
												"type": "WebActivity",
												"dependsOn": [],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].id)",
														"type": "Expression"
													},
													"method": "PATCH",
													"headers": {
														"Authorization": {
															"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
															"type": "Expression"
														},
														"Content-Type": "application/json"
													},
													"body": {
														"value": "@concat('{\"tags\": [\"Approved\"]}')",
														"type": "Expression"
													}
												}
											},
											{
												"name": "WEB_Update_Published_UAT_VVPM",
												"type": "WebActivity",
												"dependsOn": [
													{
														"activity": "WEB_update_tag_Approved",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
														"type": "Expression"
													},
													"method": "PUT",
													"headers": {
														"Authorization": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"Content-Type": "application/x-www-form-urlencoded"
													},
													"body": "published_from_uat_to_prod__c=true&placeholder_created__c=true"
												}
											},
											{
												"name": "SP_add_asset_log_Assetlog",
												"type": "SqlServerStoredProcedure",
												"dependsOn": [
													{
														"activity": "006_PL_Email_Notification_MC_AFD_copy1",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"storedProcedureName": "[[VFR].[add_asset_log]",
													"storedProcedureParameters": {
														"created_by": {
															"value": {
																"value": "@pipeline().Pipeline",
																"type": "Expression"
															},
															"type": "String"
														},
														"created_date": {
															"value": {
																"value": "@utcnow()",
																"type": "Expression"
															},
															"type": "DateTime"
														},
														"error_activity_name": {
															"value": null,
															"type": "String"
														},
														"error_message": {
															"value": null,
															"type": "String"
														},
														"error_timestamp": {
															"value": null,
															"type": "DateTime"
														},
														"execution_id": {
															"value": {
																"value": "@pipeline().parameters.Execution_ID",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_id": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_name": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_type": {
															"value": "VINCI MC Email",
															"type": "String"
														},
														"status": {
															"value": "MC Email Template Expiry - Success",
															"type": "String"
														},
														"target_asset_id": {
															"value": {
																"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].id",
																"type": "Expression"
															},
															"type": "String"
														},
														"target_asset_name": {
															"value": {
																"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].name",
																"type": "Expression"
															},
															"type": "String"
														},
														"target_asset_type": {
															"value": "VINCI MC Email",
															"type": "String"
														}
													}
												},
												"linkedServiceName": {
													"referenceName": "SqlServer1",
													"type": "LinkedServiceReference"
												}
											},
											{
												"name": "SET_Processed_asset_count",
												"type": "SetVariable",
												"dependsOn": [
													{
														"activity": "SP_add_asset_log_Assetlog",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"userProperties": [],
												"typeProperties": {
													"variableName": "processed",
													"value": {
														"value": "@string(add(int(variables('increment')),1))",
														"type": "Expression"
													}
												}
											},
											{
												"name": "SET_Increment variable",
												"type": "SetVariable",
												"dependsOn": [
													{
														"activity": "SET_Processed_asset_count",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"userProperties": [],
												"typeProperties": {
													"variableName": "increment",
													"value": {
														"value": "@variables('processed')",
														"type": "Expression"
													}
												}
											},
											{
												"name": "006_PL_Email_Notification_MC_AFD_copy1",
												"type": "ExecutePipeline",
												"dependsOn": [
													{
														"activity": "WEB_Update_Published_UAT_VVPM",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "006_PL_MC_AFD_Email_Notification",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"AFD_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.AFD_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_Country_Details": {
															"value": "@pipeline().parameters.VVPM_Country_Details",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Flag_Update_Status": {
															"value": "@activity('WEB_Update_Published_UAT_VVPM').output",
															"type": "Expression"
														}
													}
												}
											}
										]
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"AFD_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Country_Details": {
						"type": "object"
					},
					"BU_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"ML_Expiration_date": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/006_PL_MC_AFD_Email_Notification')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_Cancelled_Withdrawn_Product')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "IF_SingleBU",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "LK_Get_Emailer_Document_FolderID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(pipeline().parameters.BU_Details.firstRow.has_multiple_country,false)",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "PL_003_PL_Folder_Creation_Master_MultipleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "007_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_MultipleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Cancelled_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														},
														"NotReApproved_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Withdrawn_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
															"type": "Expression"
														}
													}
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "PL_006_PL_Cancelled_Folder_Creation_Master_SingleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "006_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_SingleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Cancelled_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														},
														"NotReApproved_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Withdrawn_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
															"type": "Expression"
														}
													}
												}
											}
										]
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',pipeline().parameters.VVPM_Doc_Details.data[0].product__v[0],'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Emailer_Document_FolderID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Archival_Folder_ID": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"VVPM_Country_Details": {
						"type": "object"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:02:11Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable14')]",
				"[concat(variables('factoryId'), '/pipelines/007_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_MultipleBU')]",
				"[concat(variables('factoryId'), '/pipelines/006_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_SingleBU')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_Draft_Product')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Abbrevation,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "IF_SingleBU",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(pipeline().parameters.BU_Details.firstRow.has_multiple_country,false)",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "PL_003_PL_Folder_Creation_Master_MultipleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "007_PL_MC_Draft_Folder_Creation_Master_MultipleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_IQ_Folder_ID": {
															"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"Draft_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Draft_Error_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Draft_Error_EmailTemplate_ID",
															"type": "Expression"
														},
														"ReDraft_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Name",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Email_Asset_type": {
															"value": "@pipeline().parameters.Email_Asset_Type",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Abbrevation,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														}
													}
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "PL_003_PL_Folder_Creation_Master_SingleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "006_PL_MC_Draft_Folder_Creation_Master_SingleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_IQ_Folder_ID": {
															"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"Draft_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Draft_Error_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Draft_Error_EmailTemplate_ID",
															"type": "Expression"
														},
														"ReDraft_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Name",
															"type": "Expression"
														},
														"Product_details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Abbrevation,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"Email_Asset_type": {
															"value": "@pipeline().parameters.Email_Asset_Type",
															"type": "Expression"
														}
													}
												}
											}
										]
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',item(),'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Draft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Draft_Error_EmailTemplate_ID": {
						"type": "string"
					},
					"ReDraft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"BU_Details": {
						"type": "object"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"VINCI_MC_IQ_Folder_ID": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Email_Asset_Type": {
						"type": "object"
					},
					"VVPM_Country_Abbrevation": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"Digital_Factory_BU": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/007_PL_MC_Draft_Folder_Creation_Master_MultipleBU')]",
				"[concat(variables('factoryId'), '/pipelines/006_PL_MC_Draft_Folder_Creation_Master_SingleBU')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_Expiry_Product')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "IF_SingleBU",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "LK_Get_Emailer_Document_FolderID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(pipeline().parameters.BU_Details.firstRow.has_multiple_country,false)",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "PL_003_PL_Folder_Creation_Master_MultipleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Expiry_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"ML_Access_Token": {
															"value": "@pipeline().parameters.ML_Access_Token",
															"type": "Expression"
														},
														"ML_BaseUrl": {
															"value": "@pipeline().parameters.ML_BaseUrl",
															"type": "Expression"
														},
														"Media_Library_Email_TemplateID": {
															"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
															"type": "Expression"
														},
														"Librarian_EmailID": {
															"value": "@pipeline().parameters.Librarian_EmailID",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														}
													}
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "PL_004_PL_Expiry_Folder_Creation_Master_SingleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "006_PL_MC_Expiry_Folder_Creation_Master_SingleBU",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Expiry_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Librarian_EmailID": {
															"value": "@pipeline().parameters.Librarian_EmailID",
															"type": "Expression"
														},
														"Media_Library_Email_TemplateID": {
															"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
															"type": "Expression"
														},
														"ML_BaseUrl": {
															"value": "@pipeline().parameters.ML_BaseUrl",
															"type": "Expression"
														},
														"ML_Access_Token": {
															"value": "@pipeline().parameters.ML_Access_Token",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														}
													}
												}
											}
										]
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',pipeline().parameters.VVPM_Doc_Details.data[0].product__v[0],'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Emailer_Document_FolderID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Archival_Folder_ID": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"VVPM_Country_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable12')]",
				"[concat(variables('factoryId'), '/pipelines/007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU')]",
				"[concat(variables('factoryId'), '/pipelines/006_PL_MC_Expiry_Folder_Creation_Master_SingleBU')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_Expiry_Product1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "IF_SingleBU",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "LK_Get_Emailer_Document_FolderID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(pipeline().parameters.BU_Details.firstRow.has_multiple_country,false)",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "PL_003_PL_Folder_Creation_Master_MultipleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU1",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Expiry_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"ML_Access_Token": {
															"value": "@pipeline().parameters.ML_Access_Token",
															"type": "Expression"
														},
														"ML_BaseUrl": {
															"value": "@pipeline().parameters.ML_BaseUrl",
															"type": "Expression"
														},
														"Media_Library_Email_TemplateID": {
															"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
															"type": "Expression"
														},
														"Librarian_EmailID": {
															"value": "@pipeline().parameters.Librarian_EmailID",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														}
													}
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "PL_004_PL_Expiry_Folder_Creation_Master_SingleBU",
												"type": "ExecutePipeline",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"pipeline": {
														"referenceName": "006_PL_MC_Expiry_Folder_Creation_Master_SingleBU1",
														"type": "PipelineReference"
													},
													"waitOnCompletion": true,
													"parameters": {
														"VINCI_MC_Count": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.count",
															"type": "Expression"
														},
														"VINCI_MC_BaseUrl": {
															"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
															"type": "Expression"
														},
														"VINCI_MC_Access_Token": {
															"value": "@pipeline().parameters.VINCI_MC_Access_Token",
															"type": "Expression"
														},
														"VVPM_Doc_Details": {
															"value": "@pipeline().parameters.VVPM_Doc_Details",
															"type": "Expression"
														},
														"VVPM_BaseUrl": {
															"value": "@pipeline().parameters.VVPM_BaseUrl",
															"type": "Expression"
														},
														"VVPM_SessionId": {
															"value": "@pipeline().parameters.VVPM_SessionId",
															"type": "Expression"
														},
														"VINCI_MC_Email_Details": {
															"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output",
															"type": "Expression"
														},
														"VINCI_MC_Archival_Folder_ID": {
															"value": "@pipeline().parameters.Archival_Folder_ID",
															"type": "Expression"
														},
														"Execution_ID": {
															"value": "@pipeline().parameters.Execution_ID",
															"type": "Expression"
														},
														"Email_Notification_Url": {
															"value": "@pipeline().parameters.Email_Notification_Url",
															"type": "Expression"
														},
														"DF_EmailID": {
															"value": "@pipeline().parameters.DF_EmailID",
															"type": "Expression"
														},
														"VVPM_Country_Name": {
															"value": "@pipeline().parameters.VVPM_Country_Details.data[0].name__v",
															"type": "Expression"
														},
														"Expiry_Success_EmailTemplate_ID": {
															"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
															"type": "Expression"
														},
														"Librarian_EmailID": {
															"value": "@pipeline().parameters.Librarian_EmailID",
															"type": "Expression"
														},
														"Media_Library_Email_TemplateID": {
															"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
															"type": "Expression"
														},
														"ML_BaseUrl": {
															"value": "@pipeline().parameters.ML_BaseUrl",
															"type": "Expression"
														},
														"ML_Access_Token": {
															"value": "@pipeline().parameters.ML_Access_Token",
															"type": "Expression"
														},
														"VVPM_Product_Details": {
															"value": "@activity('WEB_Get_VVPM_Product_Name').output",
															"type": "Expression"
														},
														"Customer_Key": {
															"value": "@concat(pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
															"type": "Expression"
														},
														"PO_EmailID": {
															"value": "@pipeline().parameters.PO_EmailID",
															"type": "Expression"
														},
														"Emailer_Document_FolderID": {
															"value": "@activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id",
															"type": "Expression"
														},
														"BU_Details": {
															"value": "@pipeline().parameters.BU_Details",
															"type": "Expression"
														}
													}
												}
											}
										]
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',pipeline().parameters.VVPM_Doc_Details.data[0].product__v[0],'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Emailer_Document_FolderID",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select folder_id from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Details.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Archival_Folder_ID": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"VVPM_Country_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable121')]",
				"[concat(variables('factoryId'), '/pipelines/007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU1')]",
				"[concat(variables('factoryId'), '/pipelines/006_PL_MC_Expiry_Folder_Creation_Master_SingleBU1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/005_PL_MC_Reapproval_Product')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_Product",
						"type": "ForEach",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].product__v",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "IF_Tag_Expired",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "WEB_Check_VVPM_Doc_VINCI_MC",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].tags[0],'Expired')",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "WEB_update_tag_notapproved_reapproval_AFD",
												"type": "WebActivity",
												"dependsOn": [],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].id)",
														"type": "Expression"
													},
													"method": "PATCH",
													"headers": {
														"Authorization": {
															"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
															"type": "Expression"
														},
														"Content-Type": "application/json"
													},
													"body": {
														"value": "@concat('{\"tags\": [\"Not Approved\"]}')",
														"type": "Expression"
													}
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "WEB_update_tag_notapproved_reapproval",
												"type": "WebActivity",
												"dependsOn": [
													{
														"activity": "WEB_Move_Document_Folder_Archived",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].id)",
														"type": "Expression"
													},
													"method": "PATCH",
													"headers": {
														"Authorization": {
															"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
															"type": "Expression"
														},
														"Content-Type": "application/json"
													},
													"body": {
														"value": "@concat('{\"tags\": [\"Not Approved\"]}')",
														"type": "Expression"
													}
												}
											},
											{
												"name": "SP_add_asset_log_Movefolder_errorlog",
												"type": "SqlServerStoredProcedure",
												"dependsOn": [
													{
														"activity": "WEB_Move_Document_Folder_Archived",
														"dependencyConditions": [
															"Failed"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"storedProcedureName": "[[VFR].[add_asset_log]",
													"storedProcedureParameters": {
														"created_by": {
															"value": {
																"value": "@pipeline().Pipeline",
																"type": "Expression"
															},
															"type": "String"
														},
														"created_date": {
															"value": {
																"value": "@utcnow()",
																"type": "Expression"
															},
															"type": "DateTime"
														},
														"error_activity_name": {
															"value": "WEB_Move_Document_Folder_Archived",
															"type": "String"
														},
														"error_message": {
															"value": {
																"value": "@activity('WEB_Move_Document_Folder_Archived').output",
																"type": "Expression"
															},
															"type": "String"
														},
														"error_timestamp": {
															"value": {
																"value": "@utcnow()",
																"type": "Expression"
															},
															"type": "DateTime"
														},
														"execution_id": {
															"value": {
																"value": "@pipeline().parameters.Execution_ID",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_id": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_name": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_type": {
															"value": "VINCI MC Email",
															"type": "String"
														},
														"status": {
															"value": "Reapproval - Emailer Document Folder Movement - Failure",
															"type": "String"
														},
														"target_asset_id": {
															"value": "Error",
															"type": "String"
														},
														"target_asset_name": {
															"value": "Error",
															"type": "String"
														},
														"target_asset_type": {
															"value": "Error",
															"type": "String"
														}
													}
												},
												"linkedServiceName": {
													"referenceName": "SqlServer1",
													"type": "LinkedServiceReference"
												}
											},
											{
												"name": "WEB_Move_Document_Folder_Archived",
												"type": "WebActivity",
												"dependsOn": [
													{
														"activity": "LK_Get_Emailer_Document_FolderID",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id)",
														"type": "Expression"
													},
													"method": "PUT",
													"headers": {
														"Authorization": {
															"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
															"type": "Expression"
														},
														"Content-Type": "application/json"
													},
													"body": {
														"value": "@concat('{\"id\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id,',\"name\": \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Name.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c,'\",\"parentId\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].parent_folder_id,'}')",
														"type": "Expression"
													}
												}
											},
											{
												"name": "LK_Get_Emailer_Document_FolderID",
												"type": "Lookup",
												"dependsOn": [],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"source": {
														"type": "SqlServerSource",
														"sqlReaderQuery": {
															"value": "@concat('select * from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Name.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c,'''')",
															"type": "Expression"
														},
														"queryTimeout": "02:00:00",
														"partitionOption": "None"
													},
													"dataset": {
														"referenceName": "SqlServerTable13",
														"type": "DatasetReference",
														"parameters": {}
													},
													"firstRowOnly": false
												}
											}
										]
									}
								},
								{
									"name": "SP_add_asset_log_Assetlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "IF_Placeholderflag_Updated",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": null,
												"type": "String"
											},
											"error_message": {
												"value": null,
												"type": "String"
											},
											"error_timestamp": {
												"value": null,
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "MC Email Template Expiry - Success",
												"type": "String"
											},
											"target_asset_id": {
												"value": {
													"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].id",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_name": {
												"value": {
													"value": "@activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].name",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_type": {
												"value": {
													"value": "@concat('VINCI MC Email Message - ',activity('WEB_Check_VVPM_Doc_VINCI_MC').output.items[0].assetType.displayName)",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SET_Processed_asset_count",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SP_add_asset_log_Assetlog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "processed",
										"value": {
											"value": "@string(add(int(variables('increment')),1))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Increment variable",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SET_Processed_asset_count",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "increment",
										"value": {
											"value": "@variables('processed')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_Update_placeholderflag_VVPM",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "IF_Tag_Expired",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"Content-Type": "application/x-www-form-urlencoded"
										},
										"body": "placeholder_created__c=false"
									}
								},
								{
									"name": "IF_Placeholderflag_Updated",
									"type": "IfCondition",
									"dependsOn": [
										{
											"activity": "WEB_Update_placeholderflag_VVPM",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"expression": {
											"value": "@equals(activity('WEB_Update_placeholderflag_VVPM').output.responseStatus,'SUCCESS')",
											"type": "Expression"
										},
										"ifFalseActivities": [
											{
												"name": "SP_add_asset_log_CountryFolder_errorlog",
												"type": "SqlServerStoredProcedure",
												"dependsOn": [],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"storedProcedureName": "[[VFR].[add_asset_log]",
													"storedProcedureParameters": {
														"created_by": {
															"value": {
																"value": "@pipeline().Pipeline",
																"type": "Expression"
															},
															"type": "String"
														},
														"created_date": {
															"value": {
																"value": "@utcnow()",
																"type": "Expression"
															},
															"type": "DateTime"
														},
														"error_activity_name": {
															"value": "Country Folder Creation Error",
															"type": "String"
														},
														"error_message": {
															"value": {
																"value": "@activity('WEB_Update_placeholderflag_VVPM').output.errors",
																"type": "Expression"
															},
															"type": "String"
														},
														"error_timestamp": {
															"value": {
																"value": "@utcnow()",
																"type": "Expression"
															},
															"type": "DateTime"
														},
														"execution_id": {
															"value": {
																"value": "@pipeline().parameters.Execution_ID",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_id": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_name": {
															"value": {
																"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
																"type": "Expression"
															},
															"type": "String"
														},
														"source_asset_type": {
															"value": "VINCI MC Email",
															"type": "String"
														},
														"status": {
															"value": "Placeholder Flag Update Failure - Reapproval",
															"type": "String"
														},
														"target_asset_id": {
															"value": "Error",
															"type": "String"
														},
														"target_asset_name": {
															"value": "Error",
															"type": "String"
														},
														"target_asset_type": {
															"value": "Error",
															"type": "String"
														}
													}
												},
												"linkedServiceName": {
													"referenceName": "SqlServer1",
													"type": "LinkedServiceReference"
												}
											}
										],
										"ifTrueActivities": [
											{
												"name": "WEB_PO_Email Notification",
												"type": "WebActivity",
												"dependsOn": [],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@pipeline().parameters.Email_Notification_Url",
														"type": "Expression"
													},
													"method": "POST",
													"headers": {},
													"body": {
														"value": "@concat('{\"template_id\": \"',pipeline().parameters.Reapproval_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name.data[0].name__v,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Name,'\"}')",
														"type": "Expression"
													}
												}
											},
											{
												"name": "WEB_DF_Email Notification",
												"type": "WebActivity",
												"dependsOn": [
													{
														"activity": "WEB_PO_Email Notification",
														"dependencyConditions": [
															"Succeeded"
														]
													}
												],
												"policy": {
													"timeout": "0.01:00:00",
													"retry": 0,
													"retryIntervalInSeconds": 30,
													"secureOutput": false,
													"secureInput": false
												},
												"userProperties": [],
												"typeProperties": {
													"url": {
														"value": "@pipeline().parameters.Email_Notification_Url",
														"type": "Expression"
													},
													"method": "POST",
													"headers": {},
													"body": {
														"value": "@concat('{\"template_id\": \"',pipeline().parameters.Reapproval_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name.data[0].name__v,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Name,'\"}')",
														"type": "Expression"
													}
												}
											}
										]
									}
								},
								{
									"name": "WEB_Get_VVPM_Product_Name",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/query?q=SELECT name__v,abbreviation__c FROM product__v WHERE id = ''',pipeline().parameters.VVPM_Doc_Details.data[0].product__v[0],'''')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Check_VVPM_Doc_VINCI_MC",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_VVPM_Product_Name",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets?$filter=customerKey=',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'-',pipeline().parameters.VVPM_Country_Name.data[0].abbreviation__c,'-',activity('WEB_Get_VVPM_Product_Name').output.data[0].abbreviation__c)",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Reapproval_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "object"
					},
					"BU_Name": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/4. Reapproval"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable13')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/006_PL_MC_AFD_Email_Notification')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_Published_uat_flag_Updated",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(pipeline().parameters.Flag_Update_Status.responseStatus,'SUCCESS')",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SP_add_asset_log_publisheduatflag_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@pipeline().parameters.Flag_Update_Status.errors",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Published from UAT to PROD Flag Update Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_AFD_DF_Email Notification",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_AFD_PO_Email Notification",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.AFD_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Details.data[0].name__v,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_AFD_PO_Email Notification",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.AFD_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Details.data[0].name__v,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"AFD_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_Country_Details": {
						"type": "object"
					},
					"BU_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Flag_Update_Status": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					},
					"ML_Expiration_date": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/2. Approved for Distribution"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/006_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_SingleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_008_Cancelled_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Cancelled_Withdrawn_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_008_Cancelled_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_009_Cancelled_Move_Archival_Single",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Cancelled_Withdrawn_Move_Archival",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Cancelled_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											},
											"NotReApproved_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Withdrawn_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:01:16Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Cancelled_Withdrawn_Create_Folder')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable14')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Cancelled_Withdrawn_Move_Archival')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/006_PL_MC_Draft_Folder_Creation_Master_SingleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_unavailable",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "WEB_update_tag_notapproved_redraft_single",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Move_Emailer_Document_Folder_to_Original_Single",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
											"type": "Expression"
										},
										"method": "PATCH",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"tags\": [\"Not Approved\"]}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "LK_Get_Emailer_Document_FolderID",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select * from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.Customer_Key,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_Assetlog_reapprove",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_007_Email_Notification_Dev_Single_redraft",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": null,
												"type": "String"
											},
											"error_message": {
												"value": null,
												"type": "String"
											},
											"error_timestamp": {
												"value": null,
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft Reapproval - Success",
												"type": "String"
											},
											"target_asset_id": {
												"value": {
													"value": "@activity('WEB_update_tag_notapproved_redraft_single').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_name": {
												"value": {
													"value": "@activity('WEB_update_tag_notapproved_redraft_single').output.name",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_type": {
												"value": {
													"value": "@concat('VINCI MC Email - ',activity('WEB_update_tag_notapproved_redraft_single').output.assetType.displayName)",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SET_Processed_asset_count_reapprove",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SP_add_asset_log_Assetlog_reapprove",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "processed",
										"value": {
											"value": "@string(add(int(variables('increment')),1))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Increment variable_reapprove",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SET_Processed_asset_count_reapprove",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "increment",
										"value": {
											"value": "@variables('processed')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_add_asset_log_Movefolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "WEB_Move_Emailer_Document_Folder_to_Original_Single",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "WEB_Move_Emailer_Document_Folder_to_Original_Single",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Move_Emailer_Document_Folder_to_Original_Single').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "ReDraft - Emailer Document Folder Movement - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "WEB_Move_Emailer_Document_Folder_to_Original_Single",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_Get_Emailer_Document_FolderID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"id\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id,',\"name\": \"',pipeline().parameters.Customer_Key,'\",\"parentId\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].parent_folder_id,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_007_Email_Notification_Dev_Single_redraft",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_update_tag_notapproved_redraft_single",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Draft_Email_Notification",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"EmailTemplate_ID": {
												"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Email_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Email_Location": {
												"value": "''''",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.Product_details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Product",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Projects_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": "Projects",
											"Folder_Type": "Project",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Document_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Project_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"Folder_Type": "Emailer Document",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Project_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Images_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Document_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": "Images",
											"Folder_Type": "Images",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Document_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.Product_details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Project_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Projects_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": "Projects"
												},
												"folder_type": {
													"type": "String",
													"value": "Project"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Document_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Document_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.Customer_Key",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Emailer Document"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Project_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_Assetlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_007_Email_Notification_Dev_Single",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": null,
												"type": "String"
											},
											"error_message": {
												"value": null,
												"type": "String"
											},
											"error_timestamp": {
												"value": null,
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Success",
												"type": "String"
											},
											"target_asset_id": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_name": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output.name",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_type": {
												"value": {
													"value": "@concat('VINCI MC Email Message - ',activity('WEB_Create_Email_Message').output.assetType.displayName)",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SET_Processed_asset_count",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SP_add_asset_log_Assetlog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "processed",
										"value": {
											"value": "@string(add(int(variables('increment')),1))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Increment variable",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SET_Processed_asset_count",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "increment",
										"value": {
											"value": "@variables('processed')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProjectFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Projects_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Project Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_DocumentFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Document_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Emailer Document Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Document_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_EmailmessageCreation_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "WEB_PO_ErrorEmail Notification_draft",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Email Message Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "WEB_PO_ErrorEmail Notification_draft",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Draft_Error_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_DF_ErrorEmail Notification_draft",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Draft_Error_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_007_Email_Notification_Dev_Single",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_update_tag_NotApproved",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Draft_Email_Notification",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Email_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Email_Location": {
												"value": "@concat('Content Builder/_IQ/',pipeline().parameters.Product_details.data[0].name__v,'/Projects/',pipeline().parameters.Customer_Key)",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Create_Email_Message",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Images_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"name\":\"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"channels\":{\"email\":true,\"web\":false},',pipeline().parameters.Email_Asset_type.firstRow.html,',\"assetType\":{\"id\":',pipeline().parameters.Email_Asset_type.firstRow.asset_type_id,'}}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_update_tag_NotApproved",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',activity('WEB_Create_Email_Message').output.id)",
											"type": "Expression"
										},
										"method": "PATCH",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"customerKey\": \"',pipeline().parameters.Customer_Key,'\",\"description\": \"',pipeline().parameters.VVPM_Doc_Details.data[0].title__v,'\",\"category\": {\"id\": ',activity('LK_Get_Document_Folder_ID_DB').output.value[0].folder_id,'},\"data\": {\"email\": {\"options\": {\"characterEncoding\": \"utf-8\"}}},\"tags\": [\"Not Approved\"]}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_IQ_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Draft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Draft_Error_EmailTemplate_ID": {
						"type": "string"
					},
					"ReDraft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Product_details": {
						"type": "object"
					},
					"BU_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Customer_Key": {
						"type": "string"
					},
					"Email_Asset_type": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable11')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Draft_Email_Notification')]",
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Draft_Create_Folder')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/006_PL_MC_Expiry_Folder_Creation_Master_SingleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_007_Expiry_Move_Archival_Single",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Expiry_Move_Archival",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Expiry_Create_Folder')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable12')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Expiry_Move_Archival')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/006_PL_MC_Expiry_Folder_Creation_Master_SingleBU1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_007_Expiry_Move_Archival_Single",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Expiry_Move_Archival1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Expiry_Create_Folder1')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable121')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Expiry_Move_Archival1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/007_PL_MC_Cancelled_Withdrawn_Folder_Creation_Master_MultipleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_008_Cancelled_Create_Country_Folder_Loop_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Cancelled_Withdrawn_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Country",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_008_Cancelled_Create_Product_Folder_Loop_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Country_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Cancelled_Withdrawn_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Country_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Country_Folder_Loop_Multiple",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Country_Name",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Country"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Product_Folder_Loop_Multiple",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable14",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_CountryFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Country_Folder_Loop_Multiple",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_008_Cancelled_Create_Country_Folder_Loop_Multiple').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Country Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_008_Cancelled_Create_Product_Folder_Loop_Multiple",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_008_Cancelled_Create_Product_Folder_Loop_Multiple').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_009_Cancelled_Move_Archival_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Cancelled_Withdrawn_Move_Archival",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Cancelled_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											},
											"NotReApproved_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Withdrawn_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T07:00:29Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Cancelled_Withdrawn_Create_Folder')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable14')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Cancelled_Withdrawn_Move_Archival')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/007_PL_MC_Draft_Folder_Creation_Master_MultipleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_unavailable",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "WEB_update_tag_notapproved_redraft_multiple",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Move_Document_Folder_Archived",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
											"type": "Expression"
										},
										"method": "PATCH",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"tags\": [\"Not Approved\"]}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "LK_Get_Emailer_Document_FolderID",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@concat('select * from [VFR].[vinci_mc_folder_master] where folder_type = ''Emailer Document'' and folder_name = ''',pipeline().parameters.Customer_Key,'''')",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_Assetlog_reapprove",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_007_Email_Notification_Dev_Multiple_redraft",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": null,
												"type": "String"
											},
											"error_message": {
												"value": null,
												"type": "String"
											},
											"error_timestamp": {
												"value": null,
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft Reapproval - Success",
												"type": "String"
											},
											"target_asset_id": {
												"value": {
													"value": "@activity('WEB_update_tag_notapproved_redraft_multiple').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_name": {
												"value": {
													"value": "@activity('WEB_update_tag_notapproved_redraft_multiple').output.name",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_type": {
												"value": {
													"value": "@concat('VINCI MC Email - ',activity('WEB_update_tag_notapproved_redraft_multiple').output.assetType.displayName)",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SET_Processed_asset_count_reapprove",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SP_add_asset_log_Assetlog_reapprove",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "processed",
										"value": {
											"value": "@string(add(int(variables('increment')),1))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Increment variable_reapprove",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SET_Processed_asset_count_reapprove",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "increment",
										"value": {
											"value": "@variables('processed')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_add_asset_log_Movefolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "WEB_Move_Document_Folder_Archived",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "WEB_Move_Document_Folder_Archived",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Move_Document_Folder_Archived').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "ReDraft - Emailer Document Folder Movement - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "WEB_Move_Document_Folder_Archived",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "LK_Get_Emailer_Document_FolderID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id)",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"id\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].folder_id,',\"name\": \"',pipeline().parameters.Customer_Key,'\",\"parentId\": ',activity('LK_Get_Emailer_Document_FolderID').output.value[0].parent_folder_id,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_007_Email_Notification_Dev_Multiple_redraft",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_update_tag_notapproved_redraft_multiple",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Draft_Email_Notification",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"EmailTemplate_ID": {
												"value": "@pipeline().parameters.ReDraft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Email_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Email_Location": {
												"value": "''''",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Country_folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"Folder_Type": "Country",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Country_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Product",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Projects_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": "Projects",
											"Folder_Type": "Project",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Document_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Project_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"Folder_Type": "Emailer Document",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Project_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Images_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Document_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Draft_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": "Images",
											"Folder_Type": "Images",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Document_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Country_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Country_Name",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Country"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_IQ_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Project_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Projects_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": "Projects"
												},
												"folder_type": {
													"type": "String",
													"value": "Project"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Document_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Document_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.Customer_Key",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Emailer Document"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Project_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable11",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_Assetlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_007_Email_Notification_Dev_Multiple",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": null,
												"type": "String"
											},
											"error_message": {
												"value": null,
												"type": "String"
											},
											"error_timestamp": {
												"value": null,
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Success",
												"type": "String"
											},
											"target_asset_id": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_name": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output.name",
													"type": "Expression"
												},
												"type": "String"
											},
											"target_asset_type": {
												"value": {
													"value": "@concat('VINCI MC Email Message - ',activity('WEB_Create_Email_Message').output.assetType.displayName)",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SET_Processed_asset_count",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SP_add_asset_log_Assetlog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "processed",
										"value": {
											"value": "@string(add(int(variables('increment')),1))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Increment variable",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "SET_Processed_asset_count",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "increment",
										"value": {
											"value": "@variables('processed')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_add_asset_log_CountryFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Country_folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProjectFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Projects_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Project Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_DocumentFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Document_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Emailer Document Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Document_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_EmailmessageCreation_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "WEB_PO_ErrorEmail Notification_draft",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Email Message Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Create_Email_Message').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Draft - Blank Email Template - Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "WEB_PO_ErrorEmail Notification_draft",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Draft_Error_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_DF_ErrorEmail Notification_draft",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Draft_Error_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "PL_007_Email_Notification_Dev_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_update_tag_NotApproved",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Draft_Email_Notification",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"EmailTemplate_ID": {
												"value": "@pipeline().parameters.Draft_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Email_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Email_Location": {
												"value": "@concat('Content Builder/_IQ/',pipeline().parameters.VVPM_Country_Name,'/',pipeline().parameters.VVPM_Product_Details.data[0].name__v,'/Projects/',pipeline().parameters.Customer_Key,'/',pipeline().parameters.VVPM_Doc_Details.data[0].name__v)",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "WEB_Create_Email_Message",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Images_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"name\":\"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"channels\":{\"email\":true,\"web\":false},',pipeline().parameters.Email_Asset_type.firstRow.html,',\"assetType\":{\"id\":',pipeline().parameters.Email_Asset_type.firstRow.asset_type_id,'}}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_update_tag_NotApproved",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Create_Email_Message",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',activity('WEB_Create_Email_Message').output.id)",
											"type": "Expression"
										},
										"method": "PATCH",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											},
											"Content-Type": "application/json"
										},
										"body": {
											"value": "@concat('{\"customerKey\": \"',pipeline().parameters.Customer_Key,'\",\"description\": \"',pipeline().parameters.VVPM_Doc_Details.data[0].title__v,'\",\"category\": {\"id\": ',activity('LK_Get_Document_Folder_ID_DB').output.value[0].folder_id,'},\"data\": {\"email\": {\"options\": {\"characterEncoding\": \"utf-8\"}}},\"tags\": [\"Not Approved\"]}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_IQ_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Draft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Draft_Error_EmailTemplate_ID": {
						"type": "string"
					},
					"ReDraft_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"BU_Details": {
						"type": "object"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Email_Asset_type": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable11')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Draft_Email_Notification')]",
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Draft_Create_Folder')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Country_folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Country",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Country_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Country_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Country_Name",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Country"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable12",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_CountryFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Country_folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Country Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_007_Expiry_Move_Archival_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Expiry_Move_Archival",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Expiry_Create_Folder')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable12')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Expiry_Move_Archival')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/007_PL_MC_Expiry_Folder_Creation_Master_MultipleBU1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_MC_Email_Available",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.VINCI_MC_Count,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_004_Create_Country_folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Country",
											"Parent_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_004_Create_Product_Folder_Loop",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Country_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "008_PL_MC_Expiry_Create_Folder1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"Folder_Name": {
												"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
												"type": "Expression"
											},
											"Folder_Type": "Archival - Product",
											"Parent_Folder_ID": {
												"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "LK_Get_Country_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Country_Name",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Country"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@pipeline().parameters.VINCI_MC_Archival_Folder_ID",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "LK_Get_Product_Folder_ID_DB",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
											"storedProcedureParameters": {
												"folder_id": {
													"type": "String",
													"value": null
												},
												"folder_name": {
													"type": "String",
													"value": {
														"value": "@pipeline().parameters.VVPM_Product_Details.data[0].name__v",
														"type": "Expression"
													}
												},
												"folder_type": {
													"type": "String",
													"value": "Archival - Product"
												},
												"parent_folder_id": {
													"type": "Int32",
													"value": {
														"value": "@activity('LK_Get_Country_Folder_ID_DB').output.value[0].folder_id",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "SqlServerTable121",
											"type": "DatasetReference",
											"parameters": {}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "SP_add_asset_log_CountryFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Country_folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Country_folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Country Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SP_add_asset_log_ProductFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "PL_004_Create_Product_Folder_Loop",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Product Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('PL_004_Create_Product_Folder_Loop').output",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Archival - Product Folder Creation -  Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "PL_007_Expiry_Move_Archival_Multiple",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "LK_Get_Product_Folder_ID_DB",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "009_PL_MC_Expiry_Move_Archival1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@activity('LK_Get_Product_Folder_ID_DB').output.value[0].folder_id",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Expiry_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Expiry_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"ML_BaseUrl": {
												"value": "@pipeline().parameters.ML_BaseUrl",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_Count": {
						"type": "int"
					},
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Archival_Folder_ID": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"VVPM_Product_Details": {
						"type": "object"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:59Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/008_PL_MC_Expiry_Create_Folder1')]",
				"[concat(variables('factoryId'), '/datasets/SqlServerTable121')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/009_PL_MC_Expiry_Move_Archival1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/008_PL_MC_Cancelled_Withdrawn_Create_Folder')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LK_Get_Folder_ID_DB",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
								"storedProcedureParameters": {
									"folder_id": {
										"type": "String",
										"value": null
									},
									"folder_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Name",
											"type": "Expression"
										}
									},
									"folder_type": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Type",
											"type": "Expression"
										}
									},
									"parent_folder_id": {
										"type": "Int32",
										"value": {
											"value": "@pipeline().parameters.Parent_Folder_ID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "SqlServerTable14",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "IF_Folder_Unavailable",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "LK_Get_Folder_ID_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('LK_Get_Folder_ID_DB').output.value[0].folder_id,null)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SET_VAR_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@activity('LK_Get_Folder_ID_DB').output.value[0].folder_id",
											"type": "Expression"
										}
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_Create_Folder",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/json",
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"Name\": \"',pipeline().parameters.Folder_Name,'\",\"ParentId\": ',pipeline().parameters.Parent_Folder_ID,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "WEB_Create_Folder",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@string(activity('WEB_Create_Folder').output.id)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_Add_Folder_Details_DB",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "SET_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_mc_new_folder_details]",
										"storedProcedureParameters": {
											"created_by": {
												"value": "Dhivya Veerasami",
												"type": "String"
											},
											"folder_id": {
												"value": {
													"value": "@activity('WEB_Create_Folder').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_name": {
												"value": {
													"value": "@pipeline().parameters.Folder_Name",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_type": {
												"value": {
													"value": "@pipeline().parameters.Folder_Type",
													"type": "Expression"
												},
												"type": "String"
											},
											"parent_folder_id": {
												"value": {
													"value": "@pipeline().parameters.Parent_Folder_ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"Folder_Name": {
						"type": "string"
					},
					"Folder_Type": {
						"type": "string"
					},
					"Parent_Folder_ID": {
						"type": "string"
					}
				},
				"variables": {
					"Var_Folder_ID": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:59:51Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable14')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/008_PL_MC_Draft_Create_Folder')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LK_Get_Folder_ID_DB",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
								"storedProcedureParameters": {
									"folder_id": {
										"type": "String",
										"value": null
									},
									"folder_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Name",
											"type": "Expression"
										}
									},
									"folder_type": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Type",
											"type": "Expression"
										}
									},
									"parent_folder_id": {
										"type": "Int32",
										"value": {
											"value": "@pipeline().parameters.Parent_Folder_ID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "SqlServerTable11",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "IF_Folder_Unavailable",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "LK_Get_Folder_ID_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('LK_Get_Folder_ID_DB').output.value[0].folder_id,null)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "WEB_Create_Folder",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/json",
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"Name\": \"',pipeline().parameters.Folder_Name,'\",\"ParentId\": ',pipeline().parameters.Parent_Folder_ID,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_Add_Folder_Details_DB",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "WEB_Create_Folder",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_mc_new_folder_details]",
										"storedProcedureParameters": {
											"created_by": {
												"value": "Dhivya Veerasami",
												"type": "String"
											},
											"folder_id": {
												"value": {
													"value": "@activity('WEB_Create_Folder').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_name": {
												"value": {
													"value": "@pipeline().parameters.Folder_Name",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_type": {
												"value": {
													"value": "@pipeline().parameters.Folder_Type",
													"type": "Expression"
												},
												"type": "String"
											},
											"parent_folder_id": {
												"value": {
													"value": "@pipeline().parameters.Parent_Folder_ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"Folder_Name": {
						"type": "string"
					},
					"Folder_Type": {
						"type": "string"
					},
					"Parent_Folder_ID": {
						"type": "string"
					}
				},
				"variables": {
					"Var_Folder_ID": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable11')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/008_PL_MC_Expiry_Create_Folder')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LK_Get_Folder_ID_DB",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
								"storedProcedureParameters": {
									"folder_id": {
										"type": "String",
										"value": null
									},
									"folder_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Name",
											"type": "Expression"
										}
									},
									"folder_type": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Type",
											"type": "Expression"
										}
									},
									"parent_folder_id": {
										"type": "Int32",
										"value": {
											"value": "@pipeline().parameters.Parent_Folder_ID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "SqlServerTable12",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "IF_Folder_Unavailable",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "LK_Get_Folder_ID_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('LK_Get_Folder_ID_DB').output.value[0].folder_id,null)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SET_VAR_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@activity('LK_Get_Folder_ID_DB').output.value[0].folder_id",
											"type": "Expression"
										}
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_Create_Folder",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/json",
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"Name\": \"',pipeline().parameters.Folder_Name,'\",\"ParentId\": ',pipeline().parameters.Parent_Folder_ID,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "WEB_Create_Folder",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@string(activity('WEB_Create_Folder').output.id)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_Add_Folder_Details_DB",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "SET_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_mc_new_folder_details]",
										"storedProcedureParameters": {
											"created_by": {
												"value": "Dhivya Veerasami",
												"type": "String"
											},
											"folder_id": {
												"value": {
													"value": "@activity('WEB_Create_Folder').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_name": {
												"value": {
													"value": "@pipeline().parameters.Folder_Name",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_type": {
												"value": {
													"value": "@pipeline().parameters.Folder_Type",
													"type": "Expression"
												},
												"type": "String"
											},
											"parent_folder_id": {
												"value": {
													"value": "@pipeline().parameters.Parent_Folder_ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"Folder_Name": {
						"type": "string"
					},
					"Folder_Type": {
						"type": "string"
					},
					"Parent_Folder_ID": {
						"type": "string"
					}
				},
				"variables": {
					"Var_Folder_ID": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable12')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/008_PL_MC_Expiry_Create_Folder1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "LK_Get_Folder_ID_DB",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderStoredProcedureName": "[[VFR].[get_mc_folder_id]",
								"storedProcedureParameters": {
									"folder_id": {
										"type": "String",
										"value": null
									},
									"folder_name": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Name",
											"type": "Expression"
										}
									},
									"folder_type": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.Folder_Type",
											"type": "Expression"
										}
									},
									"parent_folder_id": {
										"type": "Int32",
										"value": {
											"value": "@pipeline().parameters.Parent_Folder_ID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "SqlServerTable121",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "IF_Folder_Unavailable",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "LK_Get_Folder_ID_DB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('LK_Get_Folder_ID_DB').output.value[0].folder_id,null)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SET_VAR_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@activity('LK_Get_Folder_ID_DB').output.value[0].folder_id",
											"type": "Expression"
										}
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_Create_Folder",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/json",
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"Name\": \"',pipeline().parameters.Folder_Name,'\",\"ParentId\": ',pipeline().parameters.Parent_Folder_ID,'}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SET_Folder_ID",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "WEB_Create_Folder",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "Var_Folder_ID",
										"value": {
											"value": "@string(activity('WEB_Create_Folder').output.id)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "SP_Add_Folder_Details_DB",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "SET_Folder_ID",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_mc_new_folder_details]",
										"storedProcedureParameters": {
											"created_by": {
												"value": "Dhivya Veerasami",
												"type": "String"
											},
											"folder_id": {
												"value": {
													"value": "@activity('WEB_Create_Folder').output.id",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_name": {
												"value": {
													"value": "@pipeline().parameters.Folder_Name",
													"type": "Expression"
												},
												"type": "String"
											},
											"folder_type": {
												"value": {
													"value": "@pipeline().parameters.Folder_Type",
													"type": "Expression"
												},
												"type": "String"
											},
											"parent_folder_id": {
												"value": {
													"value": "@pipeline().parameters.Parent_Folder_ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"Folder_Name": {
						"type": "string"
					},
					"Folder_Type": {
						"type": "string"
					},
					"Parent_Folder_ID": {
						"type": "string"
					}
				},
				"variables": {
					"Var_Folder_ID": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SqlServerTable121')]",
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/009_PL_MC_Cancelled_Withdrawn_Move_Archival')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Move_Document_Folder_Archived",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',pipeline().parameters.Emailer_Document_FolderID)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
									"type": "Expression"
								},
								"Content-Type": "application/json"
							},
							"body": {
								"value": "@concat('{\"id\": ',pipeline().parameters.Emailer_Document_FolderID,',\"name\": \"',pipeline().parameters.Customer_Key,'\",\"parentId\": ',pipeline().parameters.VINCI_MC_Product_Folder_ID,'}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Update_deactivated_VVPM",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "SW_Update_tag_by_status",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								},
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": "deactivated__c=true"
						}
					},
					{
						"name": "SP_add_asset_log_Assetlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "IF_deactivated_updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": null,
									"type": "String"
								},
								"error_message": {
									"value": null,
									"type": "String"
								},
								"error_timestamp": {
									"value": null,
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "MC Email Template Expiry - Success",
									"type": "String"
								},
								"target_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].id",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].name",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_type": {
									"value": {
										"value": "@concat('VINCI MC Email Message - ',pipeline().parameters.VINCI_MC_Email_Details.items[0].assetType.displayName)",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "SET_Processed_asset_count",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SP_add_asset_log_Assetlog",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "processed",
							"value": {
								"value": "@string(add(int(variables('increment')),1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "SET_Increment variable",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SET_Processed_asset_count",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "increment",
							"value": {
								"value": "@variables('processed')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "SP_add_asset_log_Movefolder_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "WEB_Move_Archived",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_Move_Document_Folder_Archived').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Expiry File movement Error",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "IF_deactivated_updated",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "WEB_Update_deactivated_VVPM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('WEB_Update_deactivated_VVPM').output.responseStatus,'SUCCESS')",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SP_add_asset_log_deactivatedflag_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Update_deactivated_VVPM').output.errors",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Deactivated Flag Update Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "PL_010_Cancelled_Email_Notification",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "010_PL_MC_Cancelled_Withdrawn_Email_Notification",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"VINCI_MC_BaseUrl": {
												"value": "@pipeline().parameters.VINCI_MC_BaseUrl",
												"type": "Expression"
											},
											"VINCI_MC_Access_Token": {
												"value": "@pipeline().parameters.VINCI_MC_Access_Token",
												"type": "Expression"
											},
											"VINCI_MC_Email_Details": {
												"value": "@pipeline().parameters.VINCI_MC_Email_Details",
												"type": "Expression"
											},
											"VINCI_MC_Product_Folder_ID": {
												"value": "@pipeline().parameters.VINCI_MC_Product_Folder_ID",
												"type": "Expression"
											},
											"VVPM_BaseUrl": {
												"value": "@pipeline().parameters.VVPM_BaseUrl",
												"type": "Expression"
											},
											"VVPM_SessionId": {
												"value": "@pipeline().parameters.VVPM_SessionId",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_Details",
												"type": "Expression"
											},
											"Execution_ID": {
												"value": "@pipeline().parameters.Execution_ID",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"DF_EmailID": {
												"value": "@pipeline().parameters.DF_EmailID",
												"type": "Expression"
											},
											"Cancelled_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Cancelled_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Customer_Key": {
												"value": "@pipeline().parameters.Customer_Key",
												"type": "Expression"
											},
											"PO_EmailID": {
												"value": "@pipeline().parameters.PO_EmailID",
												"type": "Expression"
											},
											"Emailer_Document_FolderID": {
												"value": "@pipeline().parameters.Emailer_Document_FolderID",
												"type": "Expression"
											},
											"VVPM_Country_Name": {
												"value": "@pipeline().parameters.VVPM_Country_Name",
												"type": "Expression"
											},
											"BU_Details": {
												"value": "@pipeline().parameters.BU_Details",
												"type": "Expression"
											},
											"NotReApproved_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.NotReApproved_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Withdrawn_Success_EmailTemplate_ID": {
												"value": "@pipeline().parameters.Withdrawn_Success_EmailTemplate_ID",
												"type": "Expression"
											},
											"Flag_Update_Status": {
												"value": "@activity('WEB_Update_deactivated_VVPM').output",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "SW_Update_tag_by_status",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].status__v",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Cancelled",
									"activities": [
										{
											"name": "WEB_update_tag_Cancelled",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
													"type": "Expression"
												},
												"method": "PATCH",
												"headers": {
													"Authorization": {
														"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
														"type": "Expression"
													},
													"Content-Type": "application/json"
												},
												"body": {
													"value": "@concat('{\"tags\": [\"Cancelled\"]}')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"value": "Withdrawn",
									"activities": [
										{
											"name": "WEB_update_tag_Withdrawn",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
													"type": "Expression"
												},
												"method": "PATCH",
												"headers": {
													"Authorization": {
														"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
														"type": "Expression"
													},
													"Content-Type": "application/json"
												},
												"body": {
													"value": "@concat('{\"tags\": [\"Withdrawn\"]}')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"value": "Not Approved for Continued Use",
									"activities": [
										{
											"name": "WEB_update_tag_Not Approved for Continued Use",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
													"type": "Expression"
												},
												"method": "PATCH",
												"headers": {
													"Authorization": {
														"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
														"type": "Expression"
													},
													"Content-Type": "application/json"
												},
												"body": {
													"value": "@concat('{\"tags\": [\"Not ReApproved\"]}')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Product_Folder_ID": {
						"type": "string"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:58:56Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/010_PL_MC_Cancelled_Withdrawn_Email_Notification')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/009_PL_MC_Draft_Email_Notification')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Update_placeholderflag_VVPM",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								},
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": "placeholder_created__c=true"
						}
					},
					{
						"name": "IF_Placeholderflag_Updated",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "WEB_Update_placeholderflag_VVPM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('WEB_Update_placeholderflag_VVPM').output.responseStatus,'SUCCESS')",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SP_add_asset_log_CountryFolder_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Update_placeholderflag_VVPM').output.errors",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Placeholder Flag Update Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_PO_Email Notification",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.Email_Country_Name,'\",\"location\" : \"',pipeline().parameters.Email_Location,'\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_DF_Email Notification",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_PO_Email Notification",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.Email_Country_Name,'\",\"location\" : \"',pipeline().parameters.Email_Location,'\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"EmailTemplate_ID": {
						"type": "string"
					},
					"Email_Country_Name": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Email_Location": {
						"type": "string"
					},
					"Execution_ID": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/1. Draft"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/009_PL_MC_Expiry_Move_Archival')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Move_Document_Folder_Archived",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',pipeline().parameters.Emailer_Document_FolderID)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
									"type": "Expression"
								},
								"Content-Type": "application/json"
							},
							"body": {
								"value": "@concat('{\"id\": ',pipeline().parameters.Emailer_Document_FolderID,',\"name\": \"',pipeline().parameters.Customer_Key,'\",\"parentId\": ',pipeline().parameters.VINCI_MC_Product_Folder_ID,'}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_update_tag_Expired",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
								"type": "Expression"
							},
							"method": "PATCH",
							"headers": {
								"Authorization": {
									"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
									"type": "Expression"
								},
								"Content-Type": "application/json"
							},
							"body": {
								"value": "@concat('{\"tags\": [\"Expired\"]}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Update_deactivated_VVPM",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "PL_004_MediaLibrary_Asset_List_Email",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								},
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": "deactivated__c=true&placeholder_created__c=true"
						}
					},
					{
						"name": "SP_add_asset_log_Assetlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "IF_deactivated_updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": null,
									"type": "String"
								},
								"error_message": {
									"value": null,
									"type": "String"
								},
								"error_timestamp": {
									"value": null,
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "MC Email Template Expiry - Success",
									"type": "String"
								},
								"target_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].id",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].name",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_type": {
									"value": {
										"value": "@concat('VINCI MC Email Message - ',pipeline().parameters.VINCI_MC_Email_Details.items[0].assetType.displayName)",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "SET_Processed_asset_count",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SP_add_asset_log_Assetlog",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "processed",
							"value": {
								"value": "@string(add(int(variables('increment')),1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "SET_Increment variable",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SET_Processed_asset_count",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "increment",
							"value": {
								"value": "@variables('processed')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "PL_004_MediaLibrary_Asset_List_Email",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_update_tag_Expired",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "010_PL_MC_Expiry_MediaLibrary_Asset_List",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"ML_Access_Token": {
									"value": "@pipeline().parameters.ML_Access_Token",
									"type": "Expression"
								},
								"MediaLibrary_Base_Url": {
									"value": "@pipeline().parameters.ML_BaseUrl",
									"type": "Expression"
								},
								"VVPM_Doc_details": {
									"value": "@pipeline().parameters.VVPM_Doc_Details",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@pipeline().parameters.Email_Notification_Url",
									"type": "Expression"
								},
								"Media_Library_Email_TemplateID": {
									"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
									"type": "Expression"
								},
								"Librarian_EmailID": {
									"value": "@pipeline().parameters.Librarian_EmailID",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "SP_add_asset_log_Movefolder_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "WEB_Move_Archived",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_Move_Document_Folder_Archived').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Expiry File movement Error",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "IF_deactivated_updated",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "WEB_Update_deactivated_VVPM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('WEB_Update_deactivated_VVPM').output.responseStatus,'SUCCESS')",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SP_add_asset_log_deactivatedflag_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Update_deactivated_VVPM').output.errors",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Deactivated Flag Update Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_PO_Email Notification",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Expiry_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_DF_Email Notification",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_PO_Email Notification",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Expiry_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Product_Folder_ID": {
						"type": "string"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/010_PL_MC_Expiry_MediaLibrary_Asset_List')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/009_PL_MC_Expiry_Move_Archival1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "WEB_Move_Document_Folder_Archived",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/categories/',pipeline().parameters.Emailer_Document_FolderID)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
									"type": "Expression"
								},
								"Content-Type": "application/json"
							},
							"body": {
								"value": "@concat('{\"id\": ',pipeline().parameters.Emailer_Document_FolderID,',\"name\": \"',pipeline().parameters.Customer_Key,'\",\"parentId\": ',pipeline().parameters.VINCI_MC_Product_Folder_ID,'}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_update_tag_Expired",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VINCI_MC_BaseUrl,'.rest.marketingcloudapis.com/asset/v1/content/assets/',pipeline().parameters.VINCI_MC_Email_Details.items[0].id)",
								"type": "Expression"
							},
							"method": "PATCH",
							"headers": {
								"Authorization": {
									"value": "@concat('Bearer ',pipeline().parameters.VINCI_MC_Access_Token)",
									"type": "Expression"
								},
								"Content-Type": "application/json"
							},
							"body": {
								"value": "@concat('{\"tags\": [\"Expired\"]}')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Update_deactivated_VVPM",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "PL_004_MediaLibrary_Asset_List_Email",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@concat(pipeline().parameters.VVPM_BaseUrl,'/api/v21.2/objects/documents/',pipeline().parameters.VVPM_Doc_Details.data[0].Id)",
								"type": "Expression"
							},
							"method": "PUT",
							"headers": {
								"Authorization": {
									"value": "@pipeline().parameters.VVPM_SessionId",
									"type": "Expression"
								},
								"Content-Type": "application/x-www-form-urlencoded"
							},
							"body": "deactivated__c=true&placeholder_created__c=true"
						}
					},
					{
						"name": "SP_add_asset_log_Assetlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "IF_deactivated_updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": null,
									"type": "String"
								},
								"error_message": {
									"value": null,
									"type": "String"
								},
								"error_timestamp": {
									"value": null,
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "MC Email Template Expiry - Success",
									"type": "String"
								},
								"target_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].id",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VINCI_MC_Email_Details.items[0].name",
										"type": "Expression"
									},
									"type": "String"
								},
								"target_asset_type": {
									"value": {
										"value": "@concat('VINCI MC Email Message - ',pipeline().parameters.VINCI_MC_Email_Details.items[0].assetType.displayName)",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "SET_Processed_asset_count",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SP_add_asset_log_Assetlog",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "processed",
							"value": {
								"value": "@string(add(int(variables('increment')),1))",
								"type": "Expression"
							}
						}
					},
					{
						"name": "SET_Increment variable",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "SET_Processed_asset_count",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "increment",
							"value": {
								"value": "@variables('processed')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "PL_004_MediaLibrary_Asset_List_Email",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "WEB_update_tag_Expired",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "010_PL_MC_Expiry_MediaLibrary_Asset_List1",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"ML_Access_Token": {
									"value": "@pipeline().parameters.ML_Access_Token",
									"type": "Expression"
								},
								"MediaLibrary_Base_Url": {
									"value": "@pipeline().parameters.ML_BaseUrl",
									"type": "Expression"
								},
								"VVPM_Doc_details": {
									"value": "@pipeline().parameters.VVPM_Doc_Details",
									"type": "Expression"
								},
								"Email_Notification_Url": {
									"value": "@pipeline().parameters.Email_Notification_Url",
									"type": "Expression"
								},
								"Media_Library_Email_TemplateID": {
									"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
									"type": "Expression"
								},
								"Librarian_EmailID": {
									"value": "@pipeline().parameters.Librarian_EmailID",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "SP_add_asset_log_Movefolder_errorlog",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "WEB_Move_Document_Folder_Archived",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[VFR].[add_asset_log]",
							"storedProcedureParameters": {
								"created_by": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"created_date": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"error_activity_name": {
									"value": "WEB_Move_Archived",
									"type": "String"
								},
								"error_message": {
									"value": {
										"value": "@activity('WEB_Move_Document_Folder_Archived').output",
										"type": "Expression"
									},
									"type": "String"
								},
								"error_timestamp": {
									"value": {
										"value": "@utcnow()",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"execution_id": {
									"value": {
										"value": "@pipeline().parameters.Execution_ID",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_id": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_name": {
									"value": {
										"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
										"type": "Expression"
									},
									"type": "String"
								},
								"source_asset_type": {
									"value": "VINCI MC Email",
									"type": "String"
								},
								"status": {
									"value": "Expiry File movement Error",
									"type": "String"
								},
								"target_asset_id": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_name": {
									"value": "Error",
									"type": "String"
								},
								"target_asset_type": {
									"value": "Error",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "SqlServer1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "IF_deactivated_updated",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "WEB_Update_deactivated_VVPM",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(activity('WEB_Update_deactivated_VVPM').output.responseStatus,'SUCCESS')",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "SP_add_asset_log_deactivatedflag_errorlog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[VFR].[add_asset_log]",
										"storedProcedureParameters": {
											"created_by": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"created_date": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"error_activity_name": {
												"value": "Country Folder Creation Error",
												"type": "String"
											},
											"error_message": {
												"value": {
													"value": "@activity('WEB_Update_deactivated_VVPM').output.errors",
													"type": "Expression"
												},
												"type": "String"
											},
											"error_timestamp": {
												"value": {
													"value": "@utcnow()",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"execution_id": {
												"value": {
													"value": "@pipeline().parameters.Execution_ID",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_id": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_name": {
												"value": {
													"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].name__v",
													"type": "Expression"
												},
												"type": "String"
											},
											"source_asset_type": {
												"value": "VINCI MC Email",
												"type": "String"
											},
											"status": {
												"value": "Deactivated Flag Update Failure",
												"type": "String"
											},
											"target_asset_id": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_name": {
												"value": "Error",
												"type": "String"
											},
											"target_asset_type": {
												"value": "Error",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "SqlServer1",
										"type": "LinkedServiceReference"
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "WEB_PO_Email Notification",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Expiry_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_DF_Email Notification",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_PO_Email Notification",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@pipeline().parameters.Email_Notification_Url",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "@concat('{\"template_id\": \"',pipeline().parameters.Expiry_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Product_Folder_ID": {
						"type": "string"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Expiry_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"ML_BaseUrl": {
						"type": "string"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:58Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]",
				"[concat(variables('factoryId'), '/pipelines/010_PL_MC_Expiry_MediaLibrary_Asset_List1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/010_PL_MC_Cancelled_Withdrawn_Email_Notification')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "SW_Email_Notification_by_Status",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.VVPM_Doc_Details.data[0].status__v",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Cancelled",
									"activities": [
										{
											"name": "WEB_PO_Email Notification",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.Cancelled_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										},
										{
											"name": "WEB_DF_Email Notification",
											"type": "WebActivity",
											"dependsOn": [
												{
													"activity": "WEB_PO_Email Notification",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.Cancelled_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"value": "Withdrawn",
									"activities": [
										{
											"name": "WEB_PO_Email Notification_Withdrawn",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.Withdrawn_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										},
										{
											"name": "WEB_DF_Email Notification_Withdrawn",
											"type": "WebActivity",
											"dependsOn": [
												{
													"activity": "WEB_PO_Email Notification_Withdrawn",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.Withdrawn_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"value": "Not Approved for Continued Use",
									"activities": [
										{
											"name": "WEB_PO_Email Notification_NotReapproved",
											"type": "WebActivity",
											"dependsOn": [],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.NotReApproved_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.PO_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Project Owner\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										},
										{
											"name": "WEB_DF_Email Notification_NotReapproved",
											"type": "WebActivity",
											"dependsOn": [
												{
													"activity": "WEB_PO_Email Notification_NotReapproved",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "0.01:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"url": {
													"value": "@pipeline().parameters.Email_Notification_Url",
													"type": "Expression"
												},
												"method": "POST",
												"headers": {},
												"body": {
													"value": "@concat('{\"template_id\": \"',pipeline().parameters.NotReApproved_Success_EmailTemplate_ID,'\",\"to_email\" : \"',pipeline().parameters.DF_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",\"usertype\" : \"Digital Factory Team\",\"country\" : \"',pipeline().parameters.VVPM_Country_Name,'\",\"location\" : \"''''\",\"bu_name\" : \"',pipeline().parameters.BU_Details.firstRow.bu_name,'\"}')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"VINCI_MC_BaseUrl": {
						"type": "string"
					},
					"VINCI_MC_Access_Token": {
						"type": "string"
					},
					"VINCI_MC_Email_Details": {
						"type": "object"
					},
					"VINCI_MC_Product_Folder_ID": {
						"type": "string"
					},
					"VVPM_BaseUrl": {
						"type": "string"
					},
					"VVPM_SessionId": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Execution_ID": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"DF_EmailID": {
						"type": "string"
					},
					"Cancelled_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Customer_Key": {
						"type": "string"
					},
					"PO_EmailID": {
						"type": "string"
					},
					"Emailer_Document_FolderID": {
						"type": "string"
					},
					"VVPM_Country_Name": {
						"type": "string"
					},
					"BU_Details": {
						"type": "object"
					},
					"NotReApproved_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Withdrawn_Success_EmailTemplate_ID": {
						"type": "string"
					},
					"Flag_Update_Status": {
						"type": "object"
					}
				},
				"variables": {
					"processed": {
						"type": "String",
						"defaultValue": "0"
					},
					"increment": {
						"type": "String",
						"defaultValue": "0"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/5. Cancelled_Withdrawn"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:58:55Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/010_PL_MC_Expiry_MediaLibrary_Asset_List')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_Make_Available_Dams",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(1,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "WEB_Get_FolderId_Media_Library",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.MediaLibrary_Base_Url,'/folders')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"parent\":\"10494707\",\"clientfolderid\":null,\"name\":\"',pipeline().parameters.VVPM_Doc_details.data[0].name__v,'\",\"status\":\"inactive\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_Get_Assets_Media_Library",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_FolderId_Media_Library",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.MediaLibrary_Base_Url,'/folders/',activity('WEB_Get_FolderId_Media_Library').output.id,'/assets')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_Media_Library_Expire_Assets",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_Assets_Media_Library",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "011_PL_MC_Expiry_MediaLibrary_ExpireAsset",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"AssetList": {
												"value": "@activity('WEB_Get_Assets_Media_Library').output",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"ML_Base_Url": {
												"value": "@pipeline().parameters.MediaLibrary_Base_Url",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_details",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"ML_Access_Token": {
						"type": "string"
					},
					"MediaLibrary_Base_Url": {
						"type": "string"
					},
					"VVPM_Doc_details": {
						"type": "object"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/011_PL_MC_Expiry_MediaLibrary_ExpireAsset')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/010_PL_MC_Expiry_MediaLibrary_Asset_List1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "IF_Make_Available_Dams",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@equals(1,0)",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "WEB_Get_FolderId_Media_Library",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.MediaLibrary_Base_Url,'/folders')",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"parent\":\"10494707\",\"clientfolderid\":null,\"name\":\"',pipeline().parameters.VVPM_Doc_details.data[0].name__v,'\",\"status\":\"inactive\"}')",
											"type": "Expression"
										}
									}
								},
								{
									"name": "WEB_Get_Assets_Media_Library",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "WEB_Get_FolderId_Media_Library",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.MediaLibrary_Base_Url,'/folders/',activity('WEB_Get_FolderId_Media_Library').output.id,'/assets')",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "PL_Media_Library_Expire_Assets",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "WEB_Get_Assets_Media_Library",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "011_PL_MC_Expiry_MediaLibrary_ExpireAsset1",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"AssetList": {
												"value": "@activity('WEB_Get_Assets_Media_Library').output",
												"type": "Expression"
											},
											"ML_Access_Token": {
												"value": "@pipeline().parameters.ML_Access_Token",
												"type": "Expression"
											},
											"ML_Base_Url": {
												"value": "@pipeline().parameters.MediaLibrary_Base_Url",
												"type": "Expression"
											},
											"Email_Notification_Url": {
												"value": "@pipeline().parameters.Email_Notification_Url",
												"type": "Expression"
											},
											"VVPM_Doc_Details": {
												"value": "@pipeline().parameters.VVPM_Doc_details",
												"type": "Expression"
											},
											"Media_Library_Email_TemplateID": {
												"value": "@pipeline().parameters.Media_Library_Email_TemplateID",
												"type": "Expression"
											},
											"Librarian_EmailID": {
												"value": "@pipeline().parameters.Librarian_EmailID",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"ML_Access_Token": {
						"type": "string"
					},
					"MediaLibrary_Base_Url": {
						"type": "string"
					},
					"VVPM_Doc_details": {
						"type": "object"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/011_PL_MC_Expiry_MediaLibrary_ExpireAsset1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/011_PL_MC_Expiry_MediaLibrary_ExpireAsset')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_AssetList",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Set_Current_Unix_Timestamp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.AssetList.items",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "WEB_Updateasset_inactive",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.ML_Base_Url,'/assets/',item().id,'/expiration')",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"expire_unix_timestamp\": \"', variables('Timestamp'),'\", \"notes\": \"Set by Webdam API\",\"notify\": false}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Set_Current_Unix_Timestamp",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "Timestamp",
							"value": {
								"value": "@{div(sub(ticks(utcNow()), ticks('1970-01-01')),10000000)}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Email_Notification_MediaLibrary",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "FE_AssetList",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@pipeline().parameters.Email_Notification_Url",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {},
							"body": {
								"value": "@concat('{\"template_id\": \"',pipeline().parameters.Media_Library_Email_TemplateID,'\",\"to_email\" : \"',pipeline().parameters.Librarian_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",usertype\" : \"Media Librarian\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"AssetList": {
						"type": "object"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"ML_Base_Url": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"Timestamp": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/011_PL_MC_Expiry_MediaLibrary_ExpireAsset1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FE_AssetList",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Set_Current_Unix_Timestamp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@pipeline().parameters.AssetList.items",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "WEB_Updateasset_inactive",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@concat(pipeline().parameters.ML_Base_Url,'/assets/',item().id,'/expiration')",
											"type": "Expression"
										},
										"method": "PUT",
										"headers": {
											"Authorization": {
												"value": "@concat('Bearer ',pipeline().parameters.ML_Access_Token)",
												"type": "Expression"
											}
										},
										"body": {
											"value": "@concat('{\"expire_unix_timestamp\": \"', variables('Timestamp'),'\", \"notes\": \"Set by Webdam API\",\"notify\": false}')",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Set_Current_Unix_Timestamp",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "Timestamp",
							"value": {
								"value": "@{div(sub(ticks(utcNow()), ticks('1970-01-01')),10000000)}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "WEB_Email_Notification_MediaLibrary",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "FE_AssetList",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.01:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@pipeline().parameters.Email_Notification_Url",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {},
							"body": {
								"value": "@concat('{\"template_id\": \"',pipeline().parameters.Media_Library_Email_TemplateID,'\",\"to_email\" : \"',pipeline().parameters.Librarian_EmailID,'\",\"doc_no\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].document_number__v,'\",\"doc_name\" : \"',pipeline().parameters.VVPM_Doc_Details.data[0].name__v,'\",usertype\" : \"Media Librarian\",\"country\" : \"''''\",\"location\" : \"''''\"}')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"AssetList": {
						"type": "object"
					},
					"ML_Access_Token": {
						"type": "string"
					},
					"ML_Base_Url": {
						"type": "string"
					},
					"Email_Notification_Url": {
						"type": "string"
					},
					"VVPM_Doc_Details": {
						"type": "object"
					},
					"Media_Library_Email_TemplateID": {
						"type": "string"
					},
					"Librarian_EmailID": {
						"type": "string"
					}
				},
				"variables": {
					"Timestamp": {
						"type": "String"
					}
				},
				"folder": {
					"name": "VVPM - VINCI MC Integration/3. Expired"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-28T06:56:57Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable1')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable11')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable12')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable121')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable13')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServerTable14')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/KeyVaultLinkedService')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureKeyVault",
				"typeProperties": {
					"baseUrl": "[parameters('KeyVaultLinkedService_properties_typeProperties_baseUrl')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServer1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('SqlServer1_connectionString')]"
				}
			},
			"dependsOn": []
		}
	]
}